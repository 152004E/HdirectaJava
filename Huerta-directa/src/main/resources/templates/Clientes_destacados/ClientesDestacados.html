<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Usuarios - Huerta Directa</title>
    <link rel="icon" type="image/png" href="/images/logo_huerta.png"/>
    <link rel="stylesheet" href="/CSS/StyleDashBoardd.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
<section class="consulta-wrapper">
    <div class="consulta-container">
        <h1><i class="fas fa-users"></i> CONSULTA DE USUARIOS</h1>

        <!-- Formulario de búsqueda -->
        <form action="/consulta_usuarios" method="get">
            <div class="row mb-3">
                <div class="col-md-4">
                    <label for="dato" class="form-label">Filtro de búsqueda</label>
                    <select name="dato" id="dato" class="form-select" required>
                        <option value="id" th:selected="${datoSeleccionado == 'id'}">ID</option>
                        <option value="name_user" th:selected="${datoSeleccionado == 'name_user'}">Nombre</option>
                        <option value="email" th:selected="${datoSeleccionado == 'email'}">Correo</option>
                        <option value="role" th:selected="${datoSeleccionado == 'role'}">Rol</option>
                    </select>
                </div>

                <div class="col-md-5">
                    <label for="valor" class="form-label">Valor a consultar</label>
                    <input name="valor" type="text" class="form-control" id="valor"
                           th:value="${valorBuscado}" placeholder="Ingrese el valor...">
                </div>

                <div class="col-md-3 d-flex align-items-end gap-2">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-search"></i> Buscar
                    </button>
                    <a href="/consulta_usuarios" class="btn btn-secondary">
                        <i class="fas fa-list"></i> Ver Todos
                    </a>
                </div>
            </div>
        </form>

        <hr>

        <!-- Botones de exportación -->
        <div class="export-section">
            <h5>Exportar Datos</h5>
            <button onclick="exportarUsuariosExcel()" class="btn btn-success">
                <i class="fas fa-file-excel"></i> Exportar a Excel
            </button>
            <button onclick="exportarUsuariosPDF()" class="btn btn-danger">
                <i class="fas fa-file-pdf"></i> Exportar a PDF
            </button>
        </div>

        <hr>

        <!-- Tabla de resultados -->
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Email</th>
                    <th>Rol</th>
                    <th>Acciones</th>
                </tr>
                </thead>
                <tbody>
                <tr th:if="${usuarios == null || usuarios.isEmpty()}">
                    <td colspan="5" class="text-center">
                        <i class="fas fa-info-circle"></i> No se encontraron usuarios
                    </td>
                </tr>
                <tr th:each="usuario : ${usuarios}">
                    <td th:text="${usuario.id}"></td>
                    <td th:text="${usuario.name}"></td>
                    <td th:text="${usuario.email}"></td>
                    <td>
                        <span th:if="${usuario.idRole == 1}" class="badge bg-danger">Admin</span>
                        <span th:if="${usuario.idRole == 2}" class="badge bg-primary">Cliente</span>
                        <span th:if="${usuario.idRole != 1 && usuario.idRole != 2}"
                              class="badge bg-secondary">Otro</span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-warning"
                                    th:onclick="'editarUsuario(' + ${usuario.id} + ')'">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger"
                                    th:onclick="'eliminarUsuario(' + ${usuario.id} + ')'">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- Botón para volver -->
        <div class="text-center mt-4">
            <a href="/index" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Volver al Inicio
            </a>
        </div>
    </div>
</section>

<script>
    // Función para cambiar entre input de texto y select según el filtro
    function toggleValorInput() {
        const dato = document.getElementById('dato').value;
        const valorTexto = document.getElementById('valorTexto');
        const valorRol = document.getElementById('valorRol');

        if (dato === 'role') {
            valorTexto.style.display = 'none';
            valorRol.style.display = 'block';
            valorTexto.removeAttribute('name');
            valorRol.setAttribute('name', 'valor');
            valorRol.required = true;
            valorTexto.required = false;
        } else {
            valorTexto.style.display = 'block';
            valorRol.style.display = 'none';
            valorRol.removeAttribute('name');
            valorTexto.setAttribute('name', 'valor');
            valorTexto.required = true;
            valorRol.required = false;
        }
    }

    // Ejecutar al cargar la página para mantener el estado correcto
    document.addEventListener('DOMContentLoaded', function() {
        toggleValorInput();
    });

    function exportarUsuariosExcel() {
        const params = new URLSearchParams(window.location.search);
        window.location.href = `/api/users/exportExcel?${params.toString()}`;
    }

    function exportarUsuariosPDF() {
        const params = new URLSearchParams(window.location.search);
        window.location.href = `/api/users/exportPdf?${params.toString()}`;
    }

    function editarUsuario(id) {
        // Implementar lógica de edición
        alert('Funcionalidad de edición en desarrollo para usuario ID: ' + id);
    }

    function eliminarUsuario(id) {
        if (confirm('¿Está seguro de eliminar este usuario?')) {
            fetch(`/api/users/${id}`, {
                method: 'DELETE'
            })
                .then(response => {
                    if (response.ok) {
                        alert('Usuario eliminado exitosamente');
                        window.location.reload();
                    } else {
                        alert('Error al eliminar usuario');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error al eliminar usuario');
                });
        }
    }
</script>
</body>
</html>

<!--<!DOCTYPE html>-->
<!--<html lang="es">-->
<!--<head>-->
<!--    <meta charset="utf-8" />-->
<!--    <meta content="width=device-width, initial-scale=1.0" name="viewport" />-->
<!--    <title>Panel de Clientes Destacados - SalesPro</title>-->

<!--    &lt;!&ndash; Fuentes &ndash;&gt;-->
<!--    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet"/>-->
<!--    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>-->

<!--    &lt;!&ndash; Tailwind &ndash;&gt;-->
<!--    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>-->

<!--    &lt;!&ndash; Tu CSS &ndash;&gt;-->
<!--    <link rel="stylesheet" href="CSS/ClientesDestacados.css" />-->
<!--</head>-->
<!--<body class="flex min-h-screen">-->

<!--&lt;!&ndash; Sidebar &ndash;&gt;-->
<!--<aside class="w-64 flex-shrink-0 bg-[var(&#45;&#45;white)] shadow-lg">-->
<!--    <div class="h-16 flex items-center justify-center border-b border-[var(&#45;&#45;secondary-dark)] bg-[var(&#45;&#45;primary)] text-[var(&#45;&#45;white)]">-->
<!--        <h1 class="text-2xl font-bold">SalesPro</h1>-->
<!--    </div>-->
<!--    <nav class="mt-6">-->
<!--        <a class="flex items-center px-6 py-3 text-[var(&#45;&#45;text-light)] hover:bg-[var(&#45;&#45;secondary-light)]" href="#">-->
<!--            <span class="material-symbols-outlined mr-3">dashboard</span> Dashboard-->
<!--        </a>-->
<!--        <a class="flex items-center px-6 py-3 text-[var(&#45;&#45;text-light)] hover:bg-[var(&#45;&#45;secondary-light)]" href="#">-->
<!--            <span class="material-symbols-outlined mr-3">people</span> Clientes-->
<!--        </a>-->
<!--        <a class="flex items-center px-6 py-3 bg-[var(&#45;&#45;secondary-light)] text-[var(&#45;&#45;primary)] font-semibold" href="#">-->
<!--            <span class="material-symbols-outlined mr-3">star</span> Destacados-->
<!--        </a>-->
<!--        <a class="flex items-center px-6 py-3 text-[var(&#45;&#45;text-light)] hover:bg-[var(&#45;&#45;secondary-light)]" href="#">-->
<!--            <span class="material-symbols-outlined mr-3">sell</span> Ventas-->
<!--        </a>-->
<!--        <a class="flex items-center px-6 py-3 text-[var(&#45;&#45;text-light)] hover:bg-[var(&#45;&#45;secondary-light)]" href="#">-->
<!--            <span class="material-symbols-outlined mr-3">analytics</span> Reportes-->
<!--        </a>-->
<!--        <a class="flex items-center px-6 py-3 text-[var(&#45;&#45;text-light)] hover:bg-[var(&#45;&#45;secondary-light)]" href="#">-->
<!--            <span class="material-symbols-outlined mr-3">settings</span> Ajustes-->
<!--        </a>-->
<!--    </nav>-->
<!--</aside>-->

<!--&lt;!&ndash; Contenido Principal &ndash;&gt;-->
<!--<div class="flex-1 flex flex-col">-->
<!--    &lt;!&ndash; Header &ndash;&gt;-->
<!--    <header class="h-16 bg-[var(&#45;&#45;white)] shadow-md flex items-center justify-between px-6">-->
<!--        <div class="flex items-center">-->
<!--            <button class="text-gray-600 focus:outline-none lg:hidden">-->
<!--                <span class="material-symbols-outlined">menu</span>-->
<!--            </button>-->
<!--            <div class="relative ml-4">-->
<!--                <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">search</span>-->
<!--                <input class="form-input rounded-full pl-10 w-64 border-[var(&#45;&#45;secondary-dark)] focus:border-[var(&#45;&#45;primary)] focus:ring-2 focus:ring-[var(&#45;&#45;primary-light)]" placeholder="Buscar..." type="text"/>-->
<!--            </div>-->
<!--        </div>-->
<!--        <div class="flex items-center">-->
<!--            <button class="mr-4 text-gray-600 hover:text-[var(&#45;&#45;primary)]">-->
<!--                <span class="material-symbols-outlined">notifications</span>-->
<!--            </button>-->
<!--            <div class="flex items-center">-->
<!--                <div class="w-10 h-10 rounded-full bg-cover bg-center" style='background-image: url("https://lh3.googleusercontent.com/aida-public/...");'></div>-->
<!--                <div class="ml-3">-->
<!--                    <p class="text-sm font-medium text-[var(&#45;&#45;text-dark)]">Laura Evans</p>-->
<!--                    <p class="text-xs text-[var(&#45;&#45;text-light)]">Admin</p>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
<!--    </header>-->

<!--    &lt;!&ndash; Main &ndash;&gt;-->
<!--    <main class="flex-1 p-6">-->
<!--        &lt;!&ndash; Aquí va todo el contenido que tenías en cards, reseñas, etc. &ndash;&gt;-->
<!--        &lt;!&ndash; (No lo repito para no hacer muy largo el ejemplo, pero ya sabes que va igual que en tu HTML original) &ndash;&gt;-->
<!--    </main>-->

<!--    &lt;!&ndash; Footer &ndash;&gt;-->
<!--    <footer class="bg-[var(&#45;&#45;white)] border-t border-[var(&#45;&#45;secondary-dark)] mt-auto">-->
<!--        <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8">-->
<!--            <div class="flex flex-col items-center justify-between gap-2 md:flex-row">-->
<!--                <p class="text-sm text-[var(&#45;&#45;text-light)]">© 2024 SalesPro. Todos los derechos reservados.</p>-->
<!--                <div class="flex items-center gap-4">-->
<!--                    <a class="text-sm text-[var(&#45;&#45;text-light)] hover:text-[var(&#45;&#45;primary)] transition-colors" href="#">Sobre Nosotros</a>-->
<!--                    <a class="text-sm text-[var(&#45;&#45;text-light)] hover:text-[var(&#45;&#45;primary)] transition-colors" href="#">Contacto</a>-->
<!--                    <a class="text-sm text-[var(&#45;&#45;text-light)] hover:text-[var(&#45;&#45;primary)] transition-colors" href="#">Política de Privacidad</a>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
<!--    </footer>-->
<!--</div>-->

<!--&lt;!&ndash; JS &ndash;&gt;-->
<!--<script src="script.js"></script>-->
<!--</body>-->
<!--</html>-->



