<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title th:text="${producto.nameProduct}">Detalle del producto</title>
    <link rel="icon" type="image/png" href="/images/logo_huerta.png" />
    <link rel="stylesheet" th:href="@{/css/style.css}" />
    <link rel="stylesheet" th:href="@{/css/productos.css}" />
    <link rel="stylesheet" href="/CSS/stylePrincipal.css" />
    <link rel="stylesheet" href="/CSS/darkindex.css" />
    <link rel="stylesheet" href="/CSS/styleCategorias.css" />
    <link href="/CSS/output.css" rel="stylesheet" />
    <!--agregacion para los iconos-->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/icon?family=Material+Symbols+Outlined"
    />
  </head>
  <body>
    <!-- HEADER -->
    <!--<div th:replace="fragments/header-context :: header-content"></div>-->

    <!-- BREADCRUMB -->
    <div class="laypout-container">
      <div th:replace="fragments/navPagina :: navPagina"></div>
      <nav class="breadcrumb">
        <div th:replace="fragments/carritoProducto :: carritoProducto"></div>
      </nav>
    </div>

    <main class="container1 detalle-producto">
      <div class="detalle-grid">
        <!-- COLUMNA IZQUIERDA - GALER√çA -->
        <div class="galeria">
          <!-- Imagen principal con zoom hover -->
          <div class="imagen-principal-wrapper">
            <div class="badge-nuevo">Nuevo</div>
            <div class="badge-organico">100% Org√°nico</div>
            <div class="imagen-principal">
              <img
                th:src="@{'/images/productos/' + ${producto.imageProduct}}"
                th:alt="${producto.nameProduct}"
                class="producto-img-zoom"
              />
            </div>
          </div>

          <!-- Miniaturas -->
          <div class="galeria-miniaturas">
            <div class="miniatura activa">
              <img
                th:src="@{'/images/productos/' + ${producto.imageProduct}}"
                th:alt="${producto.nameProduct}"
              />
            </div>
          </div>
        </div>

        <!-- COLUMNA DERECHA - INFORMACI√ìN -->
        <div class="info">
          <!-- Encabezado del producto -->
          <div class="producto-header">
            <span class="categoria-tag">Verduras Frescas</span>
            <h1 class="producto-titulo" th:text="${producto.nameProduct}">
              Nombre del producto
            </h1>

            <div class="producto-rating">
              <div class="estrellas">
                <span class="estrella activa">‚òÖ</span>
                <span class="estrella activa">‚òÖ</span>
                <span class="estrella activa">‚òÖ</span>
                <span class="estrella activa">‚òÖ</span>
                <span class="estrella">‚òÖ</span>
              </div>
              <span class="rating-texto">(4.0) 127 rese√±as</span>
            </div>
          </div>

          <!-- Precio destacado -->
          <div class="precio-section">
            <div class="precio-principal">
              <span
                class="precio-actual"
                th:text="'$' + ${#numbers.formatDecimal(producto.price, 0, 'COMMA', 0, 'POINT')}"
                >$4,200</span
              >
            </div>
          </div>

          <!-- Descripci√≥n -->
          <div class="descripcion-section">
            <h3 class="seccion-titulo">Descripci√≥n</h3>
            <p
              class="producto-descripcion"
              th:text="${producto.descriptionProduct}"
            >
              Descripci√≥n detallada del producto. Productos frescos directamente
              de la huerta, cultivados de forma org√°nica y sostenible.
            </p>
          </div>

          <!-- Caracter√≠sticas destacadas -->
          <div class="caracteristicas-grid">
            <div class="caracteristica-item">
              <div class="caracteristica-icon">üå±</div>
              <div class="caracteristica-texto">
                <strong>100% Org√°nico</strong>
                <span>Sin pesticidas</span>
              </div>
            </div>
            <div class="caracteristica-item">
              <div class="caracteristica-icon">üöö</div>
              <div class="caracteristica-texto">
                <strong>Env√≠o r√°pido</strong>
                <span>24-48 horas</span>
              </div>
            </div>
            <div class="caracteristica-item">
              <div class="caracteristica-icon">‚ùÑÔ∏è</div>
              <div class="caracteristica-texto">
                <strong>S√∫per fresco</strong>
                <span>Reci√©n cosechado</span>
              </div>
            </div>
            <div class="caracteristica-item">
              <div class="caracteristica-icon">‚úì</div>
              <div class="caracteristica-texto">
                <strong>Certificado</strong>
                <span>Calidad garantizada</span>
              </div>
            </div>
          </div>

          <!-- Caja de compra mejorada -->
          <div class="compra-box">
            <div class="stock-info">
              <div th:if="${producto.stock != null and producto.stock > 0}" class="stock-disponible">
                <span class="stock-icon">‚úì</span>
                <span class="stock-texto">Stock disponible</span>
              </div>
              <div th:if="${producto.stock == null or producto.stock == 0}" class="stock-agotado">

                <span class="stock-texto">Sin stock</span>
              </div>
              <span
                th:if="${producto.stock != null and producto.stock > 0}"
                class="unidades-disponibles"
                th:text="${producto.stock + ' unidades disponibles'}"
                >67 unidades disponibles</span>
              <span
                th:if="${producto.stock == null or producto.stock == 0}"
                class="unidades-disponibles"
                style="color: #dc3545;">Producto agotado</span>
            </div>



            <!-- Botones de acci√≥n -->
            <div class="botones-accion" th:if="${producto.stock != null and producto.stock > 0}">
              <form
                th:action="@{/producto/{id}(id=${producto.idProduct})}"
                method="post"
              >
                <input
                  type="hidden"
                  name="productId"
                  th:value="${producto.idProduct}"
                />
                <input
                  type="hidden"
                  name="cantidad"
                  id="cantidadForm"
                  value="1"
                />
                <button type="button" class="btn-2" onclick="crearPago()">
                  Ir a pagar
                </button>
              </form>
              <div class="btnProducto">
                <button
                  type="button"
                  class="agregar-carrito btn-2 botonIcono"
                  th:onclick="'agregarAlCarrito(' + ${producto.idProduct} + ')'"
                  ><span class="material-symbols-outlined iconAgregar">
                    add_shopping_cart
                  </span>
                  Agregar</button>
              </div>
            </div>

            <!-- Mensaje cuando no hay stock -->
            <div class="botones-sin-stock" th:if="${producto.stock == null or producto.stock == 0}">
              <button class="btn-2 btn-disabled" disabled style="background-color: #6b7280 !important; cursor: not-allowed; opacity: 0.7;">
                <span class="material-symbols-outlined">block</span>
                Producto agotado
              </button>
            </div>

              </div>
            </div>

            <!-- Informaci√≥n adicional -->
            <div class="extra-info">
              <div class="info-item">
                <span class="info-icon">üöö</span>
                <div class="info-texto">
                  <strong>Env√≠o gratis</strong>
                  <span>En compras superiores a $50.000</span>
                </div>
              </div>
              <div class="info-item">
                <span class="info-icon">‚Ü©Ô∏è</span>
                <div class="info-texto">
                  <strong>Devoluci√≥n gratis</strong>
                  <span>Dentro de 30 d√≠as</span>
                </div>
              </div>
              <div class="info-item">
                <span class="info-icon">üîí</span>
                <div class="info-texto">
                  <strong>Compra protegida</strong>
                  <span>Por Huerta Directa</span>
                </div>
              </div>
            </div>

            <!-- M√©todos de pago -->
            <div class="metodos-pago">
              <h4>M√©todos de pago aceptados:</h4>
              <div class="pago-icons">
                <span class="pago-icon">üí≥</span>
                <span class="pago-icon">üí∞</span>
                <span class="pago-icon">üì±</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- SECCI√ìN ADICIONAL: Informaci√≥n detallada -->
      <div class="informacion-tabs">
        <div class="tabs-header">
          <button class="tab-btn active" onclick="cambiarTab('detalles')">
            Detalles del producto
          </button>
          <button class="tab-btn" onclick="cambiarTab('beneficios')">
            Beneficios
          </button>
          <button class="tab-btn" onclick="cambiarTab('conservacion')">
            Conservaci√≥n
          </button>
          <button class="tab-btn" onclick="cambiarTab('resenas')">
            Rese√±as (127)
          </button>
        </div>

        <div class="tabs-content">
          <div id="detalles" class="tab-panel active">
            <h3>Detalles del producto</h3>
            <ul class="lista-detalles">
              <li><strong>Origen:</strong> Huerta local certificada</li>
              <li><strong>Peso aproximado:</strong> 500g - 1kg</li>
              <li><strong>Tiempo de cosecha:</strong> Menos de 24 horas</li>
              <li><strong>Certificaci√≥n:</strong> Org√°nico certificado</li>
              <li><strong>Vida √∫til:</strong> 7-10 d√≠as en refrigeraci√≥n</li>
            </ul>
          </div>

          <div id="beneficios" class="tab-panel">
            <h3>Beneficios para tu salud</h3>
            <p>
              Este producto ofrece m√∫ltiples beneficios para tu bienestar y
              nutrici√≥n.
            </p>
          </div>

          <div id="conservacion" class="tab-panel">
            <h3>Consejos de conservaci√≥n</h3>
            <p>
              Para mantener la frescura del producto, te recomendamos
              almacenarlo en el refrigerador.
            </p>
          </div>

          <div id="resenas" class="tab-panel">
            <h3>Rese√±as de clientes</h3>
            <p>
              127 clientes han valorado este producto con un promedio de 4.0
              estrellas.
            </p>
          </div>
        </div>
      </div>

      <!-- SECCI√ìN: Productos relacionados -->
      <div class="productos-relacionados">
        <h2 class="seccion-titulo-principal">Tambi√©n te puede interesar</h2>
        <div class="productos-grid">
          <!-- Aqu√≠ ir√≠an productos relacionados -->
          <div class="producto-card-mini">
            <p class="texto-placeholder">
              Productos relacionados aparecer√°n aqu√≠
            </p>
          </div>
        </div>
      </div>
    </main>

    <!-- FOOTER -->
    <div class="flex w-full justify-center items-center bg-[#8bc34a]">
      <div th:replace="fragments/footer :: footer"></div>
    </div>

    <script>
      // Script para cambiar cantidad
      function cambiarCantidad(delta) {
        const input = document.getElementById("cantidad");
        const formInput = document.getElementById("cantidadForm");
        const btnMas = document.querySelector('.btn-cantidad[onclick="cambiarCantidad(1)"]');

        // Obtener el stock m√°ximo desde el atributo data-max-stock
        let maxStock = parseInt(btnMas?.getAttribute('data-max-stock')) || 99;

        let valor = parseInt(input.value) || 1;
        valor = Math.max(1, Math.min(maxStock, valor + delta));

        input.value = valor;
        if (formInput) formInput.value = valor;

        // Mostrar mensaje si se alcanza el l√≠mite
        if (valor === maxStock && delta > 0) {
          mostrarMensajeLimite(maxStock);
        }
      }

      // Funci√≥n para mostrar mensaje cuando se alcanza el l√≠mite de stock
      function mostrarMensajeLimite(maxStock) {
        // Crear mensaje temporal si no existe
        let mensaje = document.getElementById('mensaje-limite');
        if (!mensaje) {
          mensaje = document.createElement('div');
          mensaje.id = 'mensaje-limite';
          mensaje.style.cssText = 'color: #dc3545; font-size: 12px; margin-top: 5px; text-align: center;';
          document.querySelector('.cantidad-selector').appendChild(mensaje);
        }

        mensaje.textContent = `Solo hay ${maxStock} unidades disponibles`;

        // Remover mensaje despu√©s de 3 segundos
        setTimeout(() => {
          if (mensaje && mensaje.parentNode) {
            mensaje.parentNode.removeChild(mensaje);
          }
        }, 3000);
      }

      // Funci√≥n para agregar al carrito
      function agregarAlCarrito(productoId) {
        const cantidad = document.getElementById('cantidad')?.value || 1;

        fetch('/carrito/agregar', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
          },
          body: `productoId=${productoId}&cantidad=${cantidad}`
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert('Producto agregado al carrito exitosamente');
            // Actualizar contador del carrito si existe
            actualizarContadorCarrito();
          } else {
            alert('Error al agregar el producto: ' + data.message);
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Error al agregar el producto al carrito');
        });
      }

      // Funci√≥n para actualizar contador del carrito
      function actualizarContadorCarrito() {
        fetch('/carrito/count')
        .then(response => response.json())
        .then(data => {
          const contador = document.querySelector('.carrito-contador');
          if (contador && data.count !== undefined) {
            contador.textContent = data.count;
            contador.style.display = data.count > 0 ? 'block' : 'none';
          }
        })
        .catch(error => console.error('Error al actualizar contador:', error));
      }

      // Script para tabs
      function cambiarTab(tabId) {
        document
          .querySelectorAll(".tab-btn")
          .forEach((btn) => btn.classList.remove("active"));
        document
          .querySelectorAll(".tab-panel")
          .forEach((panel) => panel.classList.remove("active"));

        event.target.classList.add("active");
        document.getElementById(tabId).classList.add("active");
      }
    </script>
    <script src="/JS/script.js"></script>
  </body>
</html>
