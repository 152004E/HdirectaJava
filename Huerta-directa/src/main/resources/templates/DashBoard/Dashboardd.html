<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <!-- Link para el font -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/icon?family=Material+Symbols+Outlined"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <!-- Enlace al archivo CSS -->
    <link rel="stylesheet" href="/CSS/StyleDashBoardd.css" />
    <link href="/CSS/output.css" rel="stylesheet" />
    <link rel="icon" type="image/png" href="/images/logo_huerta.png" />
  </head>
  <body>
    <style>
      /* Estilos para el modal email */
      .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 9998;
        animation: fadeIn 0.3s;
      }

      /*Estilos para el modal Cargar datos*/
      .modalOverlayCarga {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 9998;
        animation: fadeIn 0.3s;
      }

      .modalOverlayCarga.active {
        display: block;
      }

      .modal-carga {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border-radius: 15px;
        padding: 30px;
        width: 90%;
        max-width: 500px;
        z-index: 9999;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        animation: slideDown 0.3s;
      }

      .modal-carga.active {
        display: block;
      }



      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translate(-50%, -60%);
        }
        to {
          opacity: 1;
          transform: translate(-50%, -50%);
        }
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 2px solid #689f38;
      }

      .modal-header h2 {
        color: #689f38;
        margin: 0;
        font-size: 24px;
      }

      .btn-close-modal {
        background: none;
        border: none;
        font-size: 28px;
        color: #999;
        cursor: pointer;
        transition: color 0.3s;
      }

      .btn-close-modal:hover {
        color: #333;
      }

      .form-group {
        margin-bottom: 20px;
        margin-right: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        color: #333;
        font-weight: 600;
        font-size: 14px;
      }

      .form-group input,
      .form-group textarea,
      .form-group select {
        width: 100%;
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 14px;
        transition: border-color 0.3s;
      }

      .form-group input:focus,
      .form-group textarea:focus,
      .form-group select:focus {
        outline: none;
        border-color: #689f38;
      }

      .form-group textarea {
        min-height: 150px;
        resize: vertical;
        font-family: inherit;
      }

      .recipient-type {
        display: flex;
        gap: 15px;
        margin-bottom: 15px;
      }

      .recipient-type label {
        display: flex;
        align-items: center;
        cursor: pointer;
        padding: 10px 15px;
        border: 2px solid #ddd;
        border-radius: 8px;
        transition: all 0.3s;
      }

      .recipient-type input[type="radio"] {
        margin-right: 8px;
        width: auto;
      }

      .recipient-type label:has(input:checked) {
        background: #689f38;
        color: white;
        border-color: #689f38;
      }

      .btn-send-email {
        width: 100%;
        padding: 15px;
        background: linear-gradient(135deg, #689f38, #8bc34a);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .btn-send-email:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(104, 159, 56, 0.4);
      }

      .btn-send-email:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
      }

      .loading-spinner {
        display: none;
        text-align: center;
        padding: 20px;
      }

      .loading-spinner.active {
        display: block;
      }

      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #689f38;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .result-message {
        display: none;
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
        text-align: center;
      }

      .result-message.success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .result-message.error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .result-message.active {
        display: block;
      }

      .help-text {
        font-size: 12px;
        color: #666;
        margin-top: 5px;
        font-style: italic;
        background: #fff8dc;
        padding: 10px;
        border-radius: 6px;
        border-left: 4px solid #8dc84b;
      }

      .btn-email-masivo {
        background: #8dc84b;
        border: none;
        color: white;
        padding: 12px 25px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .btn-email-masivo:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(104, 159, 56, 0.4);
        background: #689f38;
      }

      .export-section {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
        margin: 20px 0;
      }
    </style>
    <div class="container">
      <div
        th:replace="fragments/DashBoard/insadeDashBoard :: insadeDashBoard"
      ></div>

      <main>
        <h1>Dashboard</h1>

        <!-- Mensajes de √©xito/error -->
        <div th:if="${success}" class="alert alert-success">
          <i class="fas fa-check-circle"></i> <span th:text="${success}"></span>
        </div>
        <div th:if="${error}" class="alert alert-danger">
          <i class="fas fa-exclamation-circle"></i>
          <span th:text="${error}"></span>
        </div>

        <div class="insights">
          <div class="sales">
            <span class="material-symbols-outlined">analytics</span>
            <div class="middle">
              <div class="left">
                <h3 class="font-bold">Ventas</h3>
                <h1>$25,000</h1>
              </div>
              <div class="progress">
                <svg>
                  <circle cx="38" cy="38" r="36"></circle>
                </svg>
                <div class="number">
                  <p>81%</p>
                </div>
              </div>
            </div>
            <small class="text-muted">Ultimas 24 horas</small>
          </div>

          <div class="expenses">
            <span class="material-symbols-outlined">bar_chart</span>
            <div class="middle">
              <div class="left">
                <h3 class="font-bold">Gastos</h3>
                <h1>$15,567</h1>
              </div>
              <div class="progress">
                <svg>
                  <circle cx="38" cy="38" r="36"></circle>
                </svg>
                <div class="number">
                  <p>62%</p>
                </div>
              </div>
            </div>
            <small class="text-muted">Ultimas 24 horas</small>
          </div>

          <div class="income">
            <span class="material-symbols-outlined">stacked_line_chart</span>
            <div class="middle">
              <div class="left">
                <h3 class="font-bold">Ingresos</h3>
                <h1>$10,240</h1>
              </div>
              <div class="progress">
                <svg>
                  <circle cx="38" cy="38" r="36"></circle>
                </svg>
                <div class="number">
                  <p>31%</p>
                </div>
              </div>
            </div>
            <small class="text-muted">Ultimas 24 horas</small>
          </div>
        </div>

        <div class="recent-orders">
          <h2 class="font-bold">Gesti√≥n de Productos</h2>

          <!-- Total de productos -->
          <div class="total-productos" th:if="${totalProductos != null}">
            <i class="fas fa-box"></i>
            Total de Productos: <span th:text="${totalProductos}"></span>
          </div>

          <!-- Barra de b√∫squeda y filtros -->
          <form class="busqueda-filtros" method="GET" action="/Dashboardd">
            <div class="barra-busqueda">
              <input
                class="BuscarProInp"
                type="text"
                name="buscar"
                placeholder="Buscar producto..."
                th:value="${buscarActivo}"
              />
            </div>

            <div class="filtros">
              <div class="categoriaSelect">
                <select
                  class="CategoriaS"
                  id="categoria"
                  name="categoria"
                >
                  <option value="">Por categor√≠a</option>
                  <option
                    value="frutas"
                    th:selected="${categoriaActiva == 'frutas'}"
                  >
                    Frutas
                  </option>
                  <option
                    value="verduras-hortalizas"
                    th:selected="${categoriaActiva == 'verduras-hortalizas'}"
                  >
                    Verduras y Hortalizas
                  </option>
                  <option
                    value="lacteos"
                    th:selected="${categoriaActiva == 'lacteos'}"
                  >
                    L√°cteos
                  </option>
                  <option
                    value="carnes-proteinas"
                    th:selected="${categoriaActiva == 'carnes-proteinas'}"
                  >
                    Carnes y Prote√≠nas
                  </option>
                  <option
                    value="cereales-granos"
                    th:selected="${categoriaActiva == 'cereales-granos'}"
                  >
                    Cereales y Granos
                  </option>
                  <option
                    value="legumbres-secas"
                    th:selected="${categoriaActiva == 'legumbres-secas'}"
                  >
                    Legumbres Secas
                  </option>
                  <option
                    value="productos-organicos"
                    th:selected="${categoriaActiva == 'productos-organicos'}"
                  >
                    Productos Org√°nicos
                  </option>
                  <option
                    value="hierbas-especias"
                    th:selected="${categoriaActiva == 'hierbas-especias'}"
                  >
                    Hierbas y Especias
                  </option>
                  <option
                    value="miel-derivados"
                    th:selected="${categoriaActiva == 'miel-derivados'}"
                  >
                    Miel y Derivados
                  </option>
                  <option
                    value="procesados-artesanales"
                    th:selected="${categoriaActiva == 'procesados-artesanales'}"
                  >
                    Procesados Artesanales
                  </option>
                  <option
                    value="bebidas-naturales"
                    th:selected="${categoriaActiva == 'bebidas-naturales'}"
                  >
                    Bebidas Naturales
                  </option>
                  <option
                    value="plantas-semillas"
                    th:selected="${categoriaActiva == 'plantas-semillas'}"
                  >
                    Plantas y Semillas
                  </option>
                  <option
                    value="cajas-combos"
                    th:selected="${categoriaActiva == 'cajas-combos'}"
                  >
                    Cajas Mixtas o Combos
                  </option>
                </select>
                <div class="icon-container">
                  <i class="fa-solid fa-caret-down"></i>
                </div>
              </div>

              <div class="ContainerButton">
                <button type="submit" class="consultar-btn">
                  Consultar
                  <span class="material-symbols-outlined icono_search"
                    >search</span
                  >
                </button>
                <a
                  href="/Dashboardd"
                  class="consultar-btn"
                  style="
                    text-decoration: none;
                    display: flex;
                    align-items: center;
                    gap: 5px;
                  "
                >
                  Ver Todos
                  <span class="material-symbols-outlined icono_search"
                    >view_list</span
                  >
                </a>
              </div>
            </div>
          </form>

          <!-- Tabla de productos -->
          <table class="bg-amber-800" border="1" cellpadding="10" cellspacing="0">
            <thead class="text-md">
              <tr class="">
                <th class="">Nombre</th>
                <th>Categor√≠a</th>
                <th>Precio</th>
                <th>Unidad</th>
                <th>Descripci√≥n</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr th:if="${productos == null || productos.isEmpty()}">
                <td colspan="7" style="text-align: center">
                  <i class="fas fa-info-circle"></i> No se encontraron productos
                </td>
              </tr>
              <tr th:each="producto : ${productos}">
                <td th:text="${producto.nameProduct}"></td>
                <td th:text="${producto.category}"></td>
                <td
                  th:text="'$' + ${#numbers.formatDecimal(producto.price, 0, 'COMMA', 2, 'POINT')}"
                ></td>
                <td th:text="${producto.unit}"></td>
                <td
                  th:text="${#strings.length(producto.descriptionProduct) > 50 ? #strings.substring(producto.descriptionProduct, 0, 50) + '...' : producto.descriptionProduct}"
                ></td>
                <td>
                  <button
                    type="button"
                    class="btn-actualizar"
                    th:attr="data-id=${producto.idProduct}, 
           data-name=${producto.nameProduct}, 
           data-category=${producto.category}, 
           data-price=${producto.price},
           data-unit=${producto.unit},
           data-description=${producto.descriptionProduct},
           data-image=${producto.imageProduct}"
                    onclick="abrirModalEditarDesdeBoton(this)"
                  >
                    <span class="material-symbols-outlined">edit</span>
                  </button>
                  
                  <button
                    type="button"
                    class="btn-eliminar"
                    th:onclick="'eliminarProducto(' + ${producto.idProduct} + ')'"
                  >
                    <span class="material-symbols-outlined">delete</span>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>

          <!-- Botones de exportaci√≥n -->
          <div class="export-buttons">
            <button
              class="export-btn export-btn-excel"
              onclick="exportarExcel()"
            >
              <i class="fas fa-file-excel"></i> Exportar a Excel
            </button>
            <button class="export-btn export-btn-pdf" onclick="exportarPDF()">
              <i class="fas fa-file-pdf"></i> Exportar a PDF
            </button>
            <button class="btn-email-masivo" onclick="abrirModalCargaDatos()">
              <i class="fas fa-upload"></i> Carga Masiva de Productos
            </button>
          </div>
        </div>
      </main>

      <div class="right">
        <div class="top">
          <div class="theme-toggler">
            <span class="material-symbols-outlined active">light_mode</span>
            <span class="material-symbols-outlined">dark_mode</span>
          </div>
          <div th:replace="fragments/profile :: profile"></div>
        </div>

        <div class="recent-updates">
          <h2 class="font-bold">Actualizaciones</h2>
          <div class="updates">
            <div class="update">
              <div class="message">
                <p>
                  <b class="font-bold">Sistema</b> funcionando correctamente
                </p>
                <small class="text-muted">Hace 1 hora</small>
              </div>
            </div>
          </div>
        </div>

        <div class="sales-analytics">
          <h2 class="font-bold">Analiticas</h2>
          <div class="item online">
            <div class="icon">
              <span class="material-symbols-outlined">shopping_cart</span>
            </div>
            <div class="right">
              <div class="info">
                <h3 class="font-bold">ORDENES</h3>
                <small class="text-muted">Ultimas 24 horas</small>
              </div>
              <h5 class="success">+39%</h5>
              <h3>3849</h3>
            </div>
          </div>
          <div class="item offline">
            <div class="icon">
              <span class="material-symbols-outlined">local_mall</span>
            </div>
            <div class="right">
              <div class="info">
                <h3 class="font-bold">OFFLINE ORDENES</h3>
                <small class="text-muted">Ultimas 24 horas</small>
              </div>
              <h5 class="danger">-17%</h5>
              <h3>1100</h3>
            </div>
          </div>
          <div class="item customers">
            <div class="icon">
              <span class="material-symbols-outlined">person</span>
            </div>
            <div class="right">
              <div class="info">
                <h3 class="font-bold">NUEVOS CLIENTES</h3>
                <small class="text-muted">Ultimas 24 horas</small>
              </div>
              <h5 class="success">+67%</h5>
              <h3>849</h3>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal de carga de productos -->
    <div
      class="modalOverlayCarga"
      id="modalOverlayCarga"
      onclick="cerrarModalCargaDatos()"
    ></div>
    <div class="modal-carga" id="modalCargaDatos">
      <div class="modal-header">
        <h2><i class="fas fa-box-open"></i> Carga Masiva de Productos</h2>
        <button class="btn-close-modal" onclick="cerrarModalCargaDatos()">
          &times;
        </button>
      </div>

      <form
        id="formCargaProductos"
        enctype="multipart/form-data"
        onsubmit="cargarProductos(event)"
      >
        <div class="form-group">
          <label for="archivoProductos">
            <i class="fas fa-file-csv"></i> Seleccionar archivo de productos:
          </label>
          <input
            type="file"
            id="archivoProductos"
            name="archivo"
            accept=".csv,.xlsx,.xls"
            required

          />
          <div class="help-text">
            üí° <strong>Formato esperado:</strong><br />
            üìã
            <em>Nombre | Categor√≠a | Precio | Unidad | Descripci√≥n | Imagen</em
            ><br />
            üìÅ Formatos: CSV, Excel (.xlsx, .xls)
          </div>
        </div>

        <button type="submit" class="btn-send-email" id="btnCargarProductos">
          <i class="fas fa-cloud-upload-alt"></i> Cargar Productos
        </button>
      </form>

      <div class="loading-spinner" id="loadingProductos">
        <div class="spinner"></div>
        <p style="margin-top: 15px; color: #666">
          Procesando productos, por favor espera...
        </p>
      </div>

      <div class="result-message" id="resultProductos"></div>
    </div>

    <!-- Formulario de edici√≥n -->

    <!-- Modal de edici√≥n de producto -->
    <div class="modal-editar" id="modalEditarProducto">
      <div class="modal-header">
        <h2><i class="fas fa-pen"></i> Editar Producto</h2>
        <button class="btn-close-modal" onclick="cerrarModalEditar()">
          &times;
        </button>
      </div>

      <form id="formEditarProducto" method="post">
        <input type="hidden" id="idProduct" name="idProduct" />
        <div class="form-groupCategoriaUnidad">
          <div class="form-group">
            <label for="nameProduct">Nombre del Producto</label>
            <input type="text" id="nameProduct" name="nameProduct" required />
          </div>

          <div class="form-group">
            <label for="price">Precio (COP)</label>
            <input type="number" step="0.01" id="price" name="price" required />
          </div>
        </div>
        <!--div para la categoria y la unidad de medida-->
        <div class="form-groupCategoriaUnidad">
          <div class="form-group">
            <label for="category">Categor√≠a</label>
            <select id="category" name="category" required>
              <option value="">Seleccione una categor√≠a</option>
              <option value="frutas">Frutas</option>
              <option value="verduras-hortalizas">Verduras y Hortalizas</option>
              <option value="lacteos">L√°cteos</option>
              <option value="carnes-proteinas">Carnes y Prote√≠nas</option>
              <option value="cereales-granos">Cereales y Granos</option>
              <option value="legumbres-secas">Legumbres Secas</option>
              <option value="productos-organicos">Productos Org√°nicos</option>
              <option value="hierbas-especias">Hierbas y Especias</option>
              <option value="miel-derivados">Miel y Derivados</option>
              <option value="procesados-artesanales">
                Procesados Artesanales
              </option>
              <option value="bebidas-naturales">Bebidas Naturales</option>
              <option value="plantas-semillas">Plantas y Semillas</option>
              <option value="cajas-combos">Cajas Mixtas o Combos</option>
            </select>
          </div>

          <div class="form-group">
            <label for="unit">Unidad de Medida</label>
            <select id="unit" name="unit" required>
              <option value="">Seleccione una medida</option>
              <option value="kg">Kilogramos (kg)</option>
              <option value="g">Gramos (g)</option>
              <option value="lb">Libras (lb)</option>
              <option value="unidad">Unidad (u)</option>
              <option value="litro">Litros (L)</option>
              <option value="ml">Mililitros (ml)</option>
              <option value="docena">Docena</option>
              <option value="paq">Paquete</option>
              <option value="caja">Caja</option>
              <option value="otro">Otro</option>
            </select>
          </div>
        </div>
        <div class="form-groupDescripcionYImagen">
          <div class="form-group">
            <label for="descriptionProduct">Descripci√≥n</label>
            <textarea
              id="descriptionProduct"
              name="descriptionProduct"
              rows="4"
              required
            ></textarea>
          </div>
        </div>
        <div class="form-groupDescripcionYImagen">
          <div class="form-group">
            <label for="imageProduct">Imagen</label>
            <input type="text" id="imageProduct" name="imageProduct" readonly />
            <small class="text-muted">
              <i class="fas fa-info-circle"></i> La imagen actual se mantiene.
            </small>
          </div>
        </div>
        <button type="submit" class="btn-send-email">
          <i class="fas fa-save"></i> Guardar Cambios
        </button>
      </form>
    </div>

    <!-- Overlay del modal -->
    <div
      class="modalOverlayEditar"
      id="modalOverlayEditar"
      onclick="cerrarModalEditar()"
    ></div>

    <script src="/JS/dashboar.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </body>
</html>
